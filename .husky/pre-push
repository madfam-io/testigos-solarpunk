#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üöÄ Ejecutando verificaciones antes del push..."

# Ejecutar build para asegurar que compila correctamente
echo "üèóÔ∏è Construyendo el proyecto..."
npm run build
if [ $? -ne 0 ]; then
  echo "‚ùå Error al construir el proyecto. Por favor, corrige los errores antes de hacer push."
  exit 1
fi

# Verificar tama√±o del bundle
echo "üì¶ Verificando tama√±o del bundle..."
MAX_SIZE=400000 # 400KB (temporarily increased for content collections)
BUNDLE_SIZE=$(find dist -name "*.js" -exec cat {} + 2>/dev/null | wc -c | tr -d ' ')

if [ "$BUNDLE_SIZE" -gt "$MAX_SIZE" ]; then
  echo "‚ùå El tama√±o del bundle ($BUNDLE_SIZE bytes) excede el l√≠mite m√°ximo ($MAX_SIZE bytes)"
  echo "Por favor, optimiza el c√≥digo antes de hacer push."
  exit 1
fi

echo "‚úÖ Bundle size: $BUNDLE_SIZE bytes (l√≠mite: $MAX_SIZE bytes)"
echo "‚úÖ Todas las verificaciones pre-push pasaron!"