---
import MagazineCutoutImage from './MagazineCutoutImage.astro';

export interface Props {
  id: string;
  nombre: string;
  rol: string;
  edad: number;
  ocupacion: string;
  imagen?: string;
  descripcionBreve: string;
}

const { id, nombre, rol, edad, ocupacion, imagen, descripcionBreve } =
  Astro.props;

let basePath =
  import.meta.env.BASE_URL != null && import.meta.env.BASE_URL !== ''
    ? import.meta.env.BASE_URL
    : '/testigos-solarpunk';

// Ensure basePath doesn't end with a slash
if (basePath.endsWith('/')) {
  basePath = basePath.slice(0, -1);
}
---

<article class="character-card card">
  <div class="character-image">
    <MagazineCutoutImage
      src={imagen}
      alt={`Retrato de ${nombre}, ${ocupacion}`}
      width={400}
      height={300}
      type="character"
      prompt={`portrait of ${nombre}, ${ocupacion}, ${rol}, vintage magazine style`}
      cutoutStyle="emoji-md"
      theme="solar"
      context="card"
      interactive={true}
      class="character-portrait"
    />
    <span class="character-role emoji-cutout emoji-sm theme-green">{rol}</span>
  </div>

  <div class="character-info">
    <h3>{nombre}</h3>
    <p class="character-meta">
      <span>{edad} años</span> • <span>{ocupacion}</span>
    </p>
    <p class="character-description">{descripcionBreve}</p>
    <a href={`${basePath}/personajes/${id}/`} class="btn btn-primary"
      >Ver Perfil Completo</a
    >
  </div>
</article>

<style>
  .character-card {
    overflow: hidden;
    transition: all var(--transicion-normal);
  }

  .character-image {
    position: relative;
    height: 200px;
    overflow: hidden;
    margin: calc(-1 * var(--espacio-lg)) calc(-1 * var(--espacio-lg))
      var(--espacio-md);
  }

  .character-role {
    position: absolute;
    top: var(--espacio-md);
    right: var(--espacio-md);
    background-color: var(--verde-sostenible);
    color: white;
    padding: var(--espacio-xs) var(--espacio-sm);
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .character-info h3 {
    color: var(--purpura-creativo);
    margin-bottom: var(--espacio-sm);
  }

  .character-meta {
    color: var(--texto-secundario);
    font-size: 0.875rem;
    margin-bottom: var(--espacio-md);
  }

  .character-description {
    margin-bottom: var(--espacio-lg);
    line-height: 1.5;
  }

  .character-card .btn {
    width: 100%;
    text-align: center;
  }
</style>
