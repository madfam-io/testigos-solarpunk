---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { useTranslations } from '@/i18n/config';

const lang = 'en';
const t = useTranslations(lang);
let basePath =
  import.meta.env.BASE_URL != null && import.meta.env.BASE_URL !== ''
    ? import.meta.env.BASE_URL
    : '/testigos-solarpunk';

// Ensure basePath doesn't end with a slash
if (basePath.endsWith('/')) {
  basePath = basePath.slice(0, -1);
}
---

<BaseLayout
  lang={lang}
  title={t('impact.title')}
  description={t('impact.description')}
>
  <section class="hero-impacto">
    <div class="container">
      <h1>{t('impact.title2')}</h1>
      <p class="hero-description">
        {t('impact.hero.subtitle')}
      </p>
    </div>
  </section>

  <section class="impact-dashboard newspaper-bg with-columns">
    <div class="container">
      <h2>{t('impact.metrics.title')}</h2>
      <div class="metrics-grid">
        <div
          class="magazine-card card-md theme-community interactive context-feature"
        >
          <span class="metric-icon"
            ><span class="emoji-cutout emoji-lg theme-community flutter"
              >👥</span
            ></span
          >
          <span class="metric-value" data-count="50000">0</span>
          <span class="metric-label">{t('metrics.people.reached')}</span>
          <div class="metric-progress">
            <div class="progress-bar" style="width: 75%;"></div>
          </div>
          <span class="metric-goal">{t('metrics.goal')}: 100K</span>
        </div>

        <div
          class="magazine-card card-md theme-solar interactive context-feature"
        >
          <span class="metric-icon"
            ><span class="emoji-cutout emoji-lg theme-solar flutter">🎬</span
            ></span
          >
          <span class="metric-value" data-count="25">0</span>
          <span class="metric-label">{t('metrics.sketches.produced')}</span>
          <div class="metric-progress">
            <div class="progress-bar" style="width: 50%;"></div>
          </div>
          <span class="metric-goal">{t('metrics.goal')}: 50</span>
        </div>

        <div
          class="magazine-card card-md theme-green interactive context-feature"
        >
          <span class="metric-icon"
            ><span class="emoji-cutout emoji-lg theme-green flutter">🌱</span
            ></span
          >
          <span class="metric-value" data-count="5">0</span>
          <span class="metric-label">{t('metrics.active.communities')}</span>
          <div class="metric-progress">
            <div class="progress-bar" style="width: 100%;"></div>
          </div>
          <span class="metric-goal">{t('metrics.goal')}: 5</span>
        </div>

        <div
          class="magazine-card card-md theme-purple interactive context-feature"
        >
          <span class="metric-icon"
            ><span class="emoji-cutout emoji-lg theme-green flutter">💚</span
            ></span
          >
          <span class="metric-value" data-count="89">0</span><span
            class="metric-suffix">%</span
          >
          <span class="metric-label">{t('metrics.perception.change')}</span>
          <div class="metric-progress">
            <div class="progress-bar" style="width: 89%;"></div>
          </div>
          <span class="metric-goal">{t('metrics.goal')}: 80%</span>
        </div>
      </div>
    </div>
  </section>

  <section class="impact-phases">
    <div class="container">
      <h2>{t('impact.phases.title')}</h2>
      <div class="phases-impact-grid">
        <div class="phase-impact-card" data-fase="1">
          <div class="phase-header">
            <span class="phase-icon"
              ><span class="emoji-cutout emoji-lg theme-solar">🎭</span></span
            >
            <h3>{t('phase.1.title')}</h3>
          </div>
          <div class="phase-stats">
            <div class="stat-item">
              <span class="stat-value">500K+</span>
              <span class="stat-label">{t('stats.total.views')}</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">15%</span>
              <span class="stat-label">{t('stats.engagement.rate')}</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">50K</span>
              <span class="stat-label">{t('stats.shares')}</span>
            </div>
          </div>
          <div class="phase-achievements">
            <h3>{t('achievements.title')}</h3>
            <ul>
              <li>✓ {t('achievements.phase1.viral')}</li>
              <li>✓ {t('achievements.phase1.influencers')}</li>
              <li>✓ {t('achievements.phase1.trending')}</li>
            </ul>
          </div>
        </div>

        <div class="phase-impact-card" data-fase="2">
          <div class="phase-header">
            <span class="phase-icon"
              ><span class="emoji-cutout emoji-lg theme-purple">🎙️</span></span
            >
            <h3>{t('phase.2.title')}</h3>
          </div>
          <div class="phase-stats">
            <div class="stat-item">
              <span class="stat-value">Q1 2025</span>
              <span class="stat-label">{t('stats.launch')}</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">20</span>
              <span class="stat-label">{t('stats.experts.confirmed')}</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">10K</span>
              <span class="stat-label">{t('stats.preregistrations')}</span>
            </div>
          </div>
          <div class="phase-achievements">
            <h3>{t('phase2.status')}</h3>
            <ul>
              <li>○ {t('goals.phase2.weekly.episodes')}</li>
              <li>○ {t('goals.phase2.discord.community')}</li>
              <li>○ {t('goals.phase2.live.events')}</li>
            </ul>
          </div>
        </div>

        <div class="phase-impact-card" data-fase="3">
          <div class="phase-header">
            <span class="phase-icon"
              ><span class="emoji-cutout emoji-lg theme-green">🔬</span></span
            >
            <h3>{t('phase.3.title')}</h3>
          </div>
          <div class="phase-stats">
            <div class="stat-item">
              <span class="stat-value">Q3 2025</span>
              <span class="stat-label">{t('stats.pilot.start')}</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">3</span>
              <span class="stat-label">{t('stats.pilot.schools')}</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">500</span>
              <span class="stat-label">{t('stats.students')}</span>
            </div>
          </div>
          <div class="phase-achievements">
            <h3>{t('goals.title')}</h3>
            <ul>
              <li>○ {t('goals.phase3.schools.first.year')}</li>
              <li>○ {t('goals.phase3.students.impacted')}</li>
              <li>○ {t('goals.phase3.replicable.model')}</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="impact-stories">
    <div class="container">
      <h2>{t('impact.stories.title')}</h2>
      <div class="stories-grid">
        <blockquote class="story-card">
          <p>
            "{t('testimonials.maria')}"
          </p>
          <footer>
            <cite>{t('testimonials.maria.name')}</cite>
            <span class="story-location">CDMX</span>
          </footer>
        </blockquote>

        <blockquote class="story-card">
          <p>
            "{t('testimonials.roberto')}"
          </p>
          <footer>
            <cite>{t('testimonials.roberto.name')}</cite>
            <span class="story-location">Guadalajara</span>
          </footer>
        </blockquote>

        <blockquote class="story-card">
          <p>
            "{t('testimonials.carlos')}"
          </p>
          <footer>
            <cite>{t('testimonials.carlos.name')}</cite>
            <span class="story-location">Monterrey</span>
          </footer>
        </blockquote>
      </div>
    </div>
  </section>

  <section class="impact-visualization">
    <div class="container">
      <h2>{t('impact.growth.title')}</h2>
      <div class="growth-chart">
        <div class="chart-placeholder">
          <div class="chart-bars">
            <div class="bar" style="height: 20%;" data-month="Jan"></div>
            <div class="bar" style="height: 35%;" data-month="Feb"></div>
            <div class="bar" style="height: 45%;" data-month="Mar"></div>
            <div class="bar" style="height: 60%;" data-month="Apr"></div>
            <div class="bar" style="height: 75%;" data-month="May"></div>
            <div class="bar" style="height: 90%;" data-month="Jun"></div>
          </div>
        </div>
        <p class="chart-caption">{t('growth.chart.caption')}</p>
      </div>
    </div>
  </section>

  <section class="impact-partners">
    <div class="container">
      <h2>{t('impact.partners.title')}</h2>
      <p class="partners-intro">
        {t('partners.intro')}
      </p>
      <div class="partners-grid">
        <div class="partner-card">
          <div class="partner-logo">
            <span class="emoji-cutout emoji-lg theme-purple flutter">🏢</span>
          </div>
          <h3>{t('partners.sustainable.companies')}</h3>
          <p>{t('partners.sustainable.companies.desc')}</p>
        </div>
        <div class="partner-card">
          <div class="partner-logo">
            <span class="emoji-cutout emoji-lg theme-green flutter">🏫</span>
          </div>
          <h3>{t('partners.educational.institutions')}</h3>
          <p>{t('partners.educational.institutions.desc')}</p>
        </div>
        <div class="partner-card">
          <div class="partner-logo">
            <span class="emoji-cutout emoji-lg theme-green flutter">🌍</span>
          </div>
          <h3>{t('partners.environmental.ngos')}</h3>
          <p>{t('partners.environmental.ngos.desc')}</p>
        </div>
        <div class="partner-card">
          <div class="partner-logo">
            <span class="emoji-cutout emoji-lg theme-solar flutter">🎥</span>
          </div>
          <h3>{t('partners.content.creators')}</h3>
          <p>{t('partners.content.creators.desc')}</p>
        </div>
      </div>
    </div>
  </section>

  <section class="impact-cta">
    <div class="container">
      <div class="cta-content">
        <h2>{t('impact.cta.title')}</h2>
        <p>{t('impact.cta.subtitle')}</p>
        <div class="cta-actions">
          <a
            href={`${basePath}/en/resources/#patrocinadores`}
            class="btn btn-primary"
          >
            <span class="emoji-cutout emoji-button emoji-md theme-green"
              >💚</span
            >
            {t('impact.cta.support')}
          </a>
          <a href={`${basePath}/en/community/`} class="btn btn-secondary">
            <span class="emoji-cutout emoji-button emoji-md theme-community"
              >🤝</span
            >
            {t('impact.cta.volunteer')}
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .hero-impacto {
    background: linear-gradient(
      135deg,
      var(--verde-sostenible) 0%,
      var(--amarillo-solar) 100%
    );
    padding: var(--espacio-xxl) 0;
    text-align: center;
    color: var(--text-on-accent, #000000);
  }

  .hero-impacto h1 {
    font-size: 3rem;
    margin-bottom: var(--espacio-md);
  }

  .hero-description {
    font-size: 1.2rem;
    max-width: 600px;
    margin: 0 auto;
    opacity: 0.9;
  }

  /* Dashboard Section */
  .impact-dashboard {
    padding: var(--espacio-xxl) 0;
    background: var(--fondo-secundario);
  }

  .impact-dashboard h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: var(--espacio-xl);
  }

  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--espacio-xl);
  }

  .metric-icon {
    font-size: 3rem;
    display: block;
    margin-bottom: var(--espacio-md);
  }

  .metric-value {
    font-size: 3rem;
    font-weight: 900;
    color: var(--texto-primario);
    display: inline-block;
  }

  .metric-suffix {
    font-size: 2rem;
    font-weight: 900;
    color: var(--texto-primario);
  }

  .metric-label {
    display: block;
    color: var(--texto-secundario);
    margin-top: var(--espacio-sm);
    margin-bottom: var(--espacio-md);
  }

  .metric-progress {
    height: 8px;
    background: var(--fondo-secundario);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: var(--espacio-sm);
  }

  .progress-bar {
    height: 100%;
    background: linear-gradient(
      90deg,
      var(--verde-sostenible) 0%,
      var(--verde-brillante) 100%
    );
    transition: width 1s ease;
  }

  .metric-goal {
    font-size: 0.875rem;
    color: var(--texto-secundario);
  }

  /* Phases Impact */
  .impact-phases {
    padding: var(--espacio-xxl) 0;
  }

  .impact-phases h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: var(--espacio-xl);
  }

  .phases-impact-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: var(--espacio-xl);
  }

  .phase-impact-card {
    background: var(--bg-secondary, #1a1a1b);
    color: var(--text-primary, #ffffff);
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid var(--border-subtle, rgba(255, 255, 255, 0.1));
    box-shadow: 0 4px 6px var(--cutout-shadow-dark);
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }

  .phase-impact-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px var(--shadow-overlay-dark-medium);
  }

  .phase-impact-card[data-fase='1'] .phase-header {
    background: var(--fase-1-primary);
  }

  .phase-impact-card[data-fase='2'] .phase-header {
    background: var(--fase-2-primary);
  }

  .phase-impact-card[data-fase='3'] .phase-header {
    background: var(--fase-3-primary);
  }

  .phase-header {
    padding: var(--espacio-lg);
    color: var(--text-on-accent, #000000);
    text-align: center;
  }

  .phase-icon {
    font-size: 2.5rem;
    display: block;
    margin-bottom: var(--espacio-sm);
  }

  .phase-header h3 {
    margin: 0;
    color: var(--text-on-accent, #000000);
  }

  .phase-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--espacio-md);
    padding: var(--espacio-lg);
    border-bottom: 1px solid var(--borde-claro);
  }

  .stat-item {
    text-align: center;
  }

  .stat-item .stat-value {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--texto-primario);
  }

  .stat-item .stat-label {
    display: block;
    font-size: 0.75rem;
    color: var(--texto-secundario);
    margin-top: var(--espacio-xs);
  }

  .phase-achievements {
    padding: var(--espacio-lg);
  }

  .phase-achievements h3 {
    margin-bottom: var(--espacio-md);
    color: var(--texto-primario);
  }

  .phase-achievements ul {
    list-style: none;
    padding: 0;
  }

  .phase-achievements li {
    padding: var(--espacio-sm) 0;
    color: var(--texto-secundario);
  }

  /* Stories Section */
  .impact-stories {
    padding: var(--espacio-xxl) 0;
    background: var(--fondo-secundario);
  }

  .impact-stories h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: var(--espacio-xl);
  }

  .stories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--espacio-xl);
  }

  .story-card {
    background: var(--bg-secondary, #1a1a1b);
    color: var(--text-primary, #ffffff);
    padding: var(--espacio-xl);
    border-radius: 16px;
    border-left: 4px solid var(--verde-sostenible);
    border-right: 1px solid var(--border-subtle, rgba(255, 255, 255, 0.1));
    border-top: 1px solid var(--border-subtle, rgba(255, 255, 255, 0.1));
    border-bottom: 1px solid var(--border-subtle, rgba(255, 255, 255, 0.1));
    box-shadow: 0 4px 6px var(--cutout-shadow-dark);
    margin: 0;
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }

  .story-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 24px var(--shadow-overlay-dark-medium);
  }

  .story-card p {
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: var(--espacio-lg);
    font-style: italic;
  }

  .story-card footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .story-card cite {
    font-weight: 600;
    font-style: normal;
    color: var(--texto-primario);
  }

  .story-location {
    color: var(--texto-secundario);
    font-size: 0.9rem;
  }

  /* Visualization */
  .impact-visualization {
    padding: var(--espacio-xxl) 0;
  }

  .impact-visualization h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: var(--espacio-xl);
  }

  .growth-chart {
    max-width: 800px;
    margin: 0 auto;
  }

  .chart-placeholder {
    background: var(--fondo-secundario);
    padding: var(--espacio-xl);
    border-radius: 16px;
    height: 300px;
    position: relative;
  }

  .chart-bars {
    display: flex;
    align-items: flex-end;
    justify-content: space-around;
    height: 100%;
    gap: var(--espacio-md);
  }

  .bar {
    flex: 1;
    background: linear-gradient(
      to top,
      var(--verde-sostenible),
      var(--amarillo-solar)
    );
    border-radius: 8px 8px 0 0;
    position: relative;
    opacity: 0;
    animation: growBar 1s ease-out forwards;
  }

  .bar::after {
    content: attr(data-month);
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.875rem;
    color: var(--texto-secundario);
  }

  @keyframes growBar {
    to {
      opacity: 1;
    }
  }

  .bar:nth-child(1) {
    animation-delay: 0.1s;
  }
  .bar:nth-child(2) {
    animation-delay: 0.2s;
  }
  .bar:nth-child(3) {
    animation-delay: 0.3s;
  }
  .bar:nth-child(4) {
    animation-delay: 0.4s;
  }
  .bar:nth-child(5) {
    animation-delay: 0.5s;
  }
  .bar:nth-child(6) {
    animation-delay: 0.6s;
  }

  .chart-caption {
    text-align: center;
    color: var(--texto-secundario);
    margin-top: var(--espacio-xl);
  }

  /* Partners */
  .impact-partners {
    padding: var(--espacio-xxl) 0;
    background: var(--fondo-secundario);
  }

  .impact-partners h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: var(--espacio-md);
  }

  .partners-intro {
    text-align: center;
    font-size: 1.1rem;
    color: var(--texto-secundario);
    margin-bottom: var(--espacio-xl);
  }

  .partners-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--espacio-xl);
    max-width: 900px;
    margin: 0 auto;
  }

  .partner-card {
    text-align: center;
    background: var(--bg-secondary, #1a1a1b);
    color: var(--text-primary, #ffffff);
    padding: var(--espacio-xl);
    border-radius: 12px;
    border: 1px solid var(--border-subtle, rgba(255, 255, 255, 0.1));
    box-shadow: 0 4px 6px var(--cutout-shadow-dark);
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }

  .partner-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px var(--shadow-overlay-dark-medium);
  }

  .partner-logo {
    font-size: 3rem;
    margin-bottom: var(--espacio-md);
  }

  .partner-card h3 {
    margin-bottom: var(--espacio-sm);
    color: var(--verde-sostenible);
  }

  /* CTA */
  .impact-cta {
    padding: var(--espacio-xxl) 0;
    background: linear-gradient(
      135deg,
      var(--fondo-primario) 0%,
      rgba(76, 175, 80, 0.05) 100%
    );
  }

  .impact-cta .cta-content {
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
  }

  .impact-cta h2 {
    font-size: 2.5rem;
    margin-bottom: var(--espacio-md);
  }

  .impact-cta p {
    font-size: 1.2rem;
    color: var(--texto-secundario);
    margin-bottom: var(--espacio-xl);
  }

  .cta-actions {
    display: flex;
    gap: var(--espacio-md);
    justify-content: center;
  }

  @media (max-width: 768px) {
    .hero-impacto h1 {
      font-size: 2rem;
    }

    .metric-value {
      font-size: 2.5rem;
    }

    .phase-stats {
      grid-template-columns: 1fr;
    }

    .cta-actions {
      flex-direction: column;
      align-items: center;
    }
  }
</style>

<script>
  // Animate counters
  document.addEventListener('DOMContentLoaded', () => {
    const counters = document.querySelectorAll('.metric-value[data-count]');

    const animateCounter = (counter: HTMLElement) => {
      const target = parseInt(counter.dataset.count || '0');
      const duration = 2000;
      const increment = target / (duration / 16);
      let current = 0;

      const updateCounter = () => {
        current += increment;
        if (current < target) {
          counter.textContent = Math.floor(current).toLocaleString();
          requestAnimationFrame(updateCounter);
        } else {
          counter.textContent = target.toLocaleString();
        }
      };

      updateCounter();
    };

    // Intersection Observer for animation trigger
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          animateCounter(entry.target as HTMLElement);
          observer.unobserve(entry.target);
        }
      });
    });

    counters.forEach((counter) => observer.observe(counter));
  });
</script>
