---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { t } from '@/i18n/config';

let basePath =
  import.meta.env.BASE_URL != null && import.meta.env.BASE_URL !== ''
    ? import.meta.env.BASE_URL
    : '/testigos-solarpunk';

// Ensure basePath doesn't end with a slash
if (basePath.endsWith('/')) {
  basePath = basePath.slice(0, -1);
}
---

<BaseLayout
  title="Impacto"
  description="M√©tricas y resultados del proyecto Testigos de Solarpunk"
>
  <section class="hero-impacto">
    <div class="container">
      <h1>Nuestro Impacto</h1>
      <p class="hero-description">
        Medimos nuestro √©xito por las sonrisas generadas y las acciones
        inspiradas
      </p>
    </div>
  </section>

  <section class="impact-dashboard newspaper-bg with-columns">
    <div class="container">
      <h2>M√©tricas en Tiempo Real</h2>
      <div class="metrics-grid">
        <div
          class="magazine-card card-md theme-community interactive context-feature"
        >
          <span class="metric-icon"
            ><span class="emoji-cutout emoji-lg theme-community flutter"
              >üë•</span
            ></span
          >
          <span class="metric-value" data-count="50000">0</span>
          <span class="metric-label">Personas Alcanzadas</span>
          <div class="metric-progress">
            <div class="progress-bar" style="width: 75%;"></div>
          </div>
          <span class="metric-goal">Meta: 100K</span>
        </div>

        <div
          class="magazine-card card-md theme-solar interactive context-feature"
        >
          <span class="metric-icon"
            ><span class="emoji-cutout emoji-lg theme-solar flutter">üé¨</span
            ></span
          >
          <span class="metric-value" data-count="25">0</span>
          <span class="metric-label">Sketches Producidos</span>
          <div class="metric-progress">
            <div class="progress-bar" style="width: 50%;"></div>
          </div>
          <span class="metric-goal">Meta: 50</span>
        </div>

        <div
          class="magazine-card card-md theme-green interactive context-feature"
        >
          <span class="metric-icon"
            ><span class="emoji-cutout emoji-lg theme-green flutter">üå±</span
            ></span
          >
          <span class="metric-value" data-count="5">0</span>
          <span class="metric-label">Comunidades Activas</span>
          <div class="metric-progress">
            <div class="progress-bar" style="width: 100%;"></div>
          </div>
          <span class="metric-goal">Meta: 5</span>
        </div>

        <div
          class="magazine-card card-md theme-purple interactive context-feature"
        >
          <span class="metric-icon"
            ><span class="emoji-cutout emoji-lg theme-green flutter">üíö</span
            ></span
          >
          <span class="metric-value" data-count="89">0</span><span
            class="metric-suffix">%</span
          >
          <span class="metric-label">Cambio de Percepci√≥n</span>
          <div class="metric-progress">
            <div class="progress-bar" style="width: 89%;"></div>
          </div>
          <span class="metric-goal">Meta: 80%</span>
        </div>
      </div>
    </div>
  </section>

  <section class="impact-phases">
    <div class="container">
      <h2>Impacto por Fase</h2>
      <div class="phases-impact-grid">
        <div class="phase-impact-card" data-fase="1">
          <div class="phase-header">
            <span class="phase-icon"
              ><span class="emoji-cutout emoji-lg theme-solar">üé≠</span></span
            >
            <h3>Fase 1: Atracci√≥n</h3>
          </div>
          <div class="phase-stats">
            <div class="stat-item">
              <span class="stat-value">500K+</span>
              <span class="stat-label">Vistas totales</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">15%</span>
              <span class="stat-label">Tasa de engagement</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">50K</span>
              <span class="stat-label">Compartidos</span>
            </div>
          </div>
          <div class="phase-achievements">
            <h3>Logros</h3>
            <ul>
              <li>‚úì Viral en TikTok M√©xico</li>
              <li>‚úì Colaboraci√≥n con 10 influencers</li>
              <li>‚úì Trending topic #TestigosDeSolarpunk</li>
            </ul>
          </div>
        </div>

        <div class="phase-impact-card" data-fase="2">
          <div class="phase-header">
            <span class="phase-icon"
              ><span class="emoji-cutout emoji-lg theme-purple">üéôÔ∏è</span></span
            >
            <h3>Fase 2: Conexi√≥n</h3>
          </div>
          <div class="phase-stats">
            <div class="stat-item">
              <span class="stat-value">Q1 2025</span>
              <span class="stat-label">Lanzamiento</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">20</span>
              <span class="stat-label">Expertos confirmados</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">10K</span>
              <span class="stat-label">Pre-registros</span>
            </div>
          </div>
          <div class="phase-achievements">
            <h3>{t('status.coming.soon')}</h3>
            <ul>
              <li>‚óã Episodios semanales</li>
              <li>‚óã Comunidad Discord</li>
              <li>‚óã Eventos en vivo</li>
            </ul>
          </div>
        </div>

        <div class="phase-impact-card" data-fase="3">
          <div class="phase-header">
            <span class="phase-icon"
              ><span class="emoji-cutout emoji-lg theme-green">üî¨</span></span
            >
            <h3>Fase 3: Conversi√≥n</h3>
          </div>
          <div class="phase-stats">
            <div class="stat-item">
              <span class="stat-value">Q3 2025</span>
              <span class="stat-label">{t('breadcrumb.home')} piloto</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">3</span>
              <span class="stat-label">Escuelas piloto</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">500</span>
              <span class="stat-label">Estudiantes</span>
            </div>
          </div>
          <div class="phase-achievements">
            <h3>{t('section.objectives')}</h3>
            <ul>
              <li>‚óã 10 escuelas primer a√±o</li>
              <li>‚óã 5,000 estudiantes impactados</li>
              <li>‚óã Modelo replicable</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="impact-stories">
    <div class="container">
      <h2>Historias de Cambio</h2>
      <div class="stories-grid">
        <blockquote class="story-card">
          <p>
            "Los sketches me hicieron darme cuenta de que puedo ser sostenible
            sin ser perfecta. Ahora compostar es parte de mi rutina diaria."
          </p>
          <footer>
            <cite>Mar√≠a, 28 a√±os</cite>
            <span class="story-location">CDMX</span>
          </footer>
        </blockquote>

        <blockquote class="story-card">
          <p>
            "Mis alumnos ahora ven la sostenibilidad como algo cool gracias a
            los videos. Iniciamos un huerto escolar inspirados en ustedes."
          </p>
          <footer>
            <cite>Prof. Roberto</cite>
            <span class="story-location">Guadalajara</span>
          </footer>
        </blockquote>

        <blockquote class="story-card">
          <p>
            "Instal√© paneles solares despu√©s de ver el sketch del Hermano
            Voltio. Mi recibo de luz baj√≥ 80% y ahora predico el evangelio
            solar."
          </p>
          <footer>
            <cite>Carlos, 45 a√±os</cite>
            <span class="story-location">Monterrey</span>
          </footer>
        </blockquote>
      </div>
    </div>
  </section>

  <section class="impact-visualization">
    <div class="container">
      <h2>Crecimiento del Movimiento</h2>
      <div class="growth-chart">
        <div class="chart-placeholder">
          <div class="chart-bars">
            <div class="bar" style="height: 20%;" data-month="Ene"></div>
            <div class="bar" style="height: 35%;" data-month="Feb"></div>
            <div class="bar" style="height: 45%;" data-month="Mar"></div>
            <div class="bar" style="height: 60%;" data-month="Abr"></div>
            <div class="bar" style="height: 75%;" data-month="May"></div>
            <div class="bar" style="height: 90%;" data-month="Jun"></div>
          </div>
        </div>
        <p class="chart-caption">Crecimiento mensual de la comunidad</p>
      </div>
    </div>
  </section>

  <section class="impact-partners">
    <div class="container">
      <h2>Aliados del Cambio</h2>
      <p class="partners-intro">
        Organizaciones que hacen posible nuestro impacto
      </p>
      <div class="partners-grid">
        <div class="partner-card">
          <div class="partner-logo">
            <span class="emoji-cutout emoji-lg theme-purple flutter">üè¢</span>
          </div>
          <h3>Empresas Sostenibles</h3>
          <p>Apoyo financiero y recursos</p>
        </div>
        <div class="partner-card">
          <div class="partner-logo">
            <span class="emoji-cutout emoji-lg theme-green flutter">üè´</span>
          </div>
          <h3>Instituciones Educativas</h3>
          <p>Espacios y comunidades</p>
        </div>
        <div class="partner-card">
          <div class="partner-logo">
            <span class="emoji-cutout emoji-lg theme-green flutter">üåç</span>
          </div>
          <h3>ONGs Ambientales</h3>
          <p>Expertise y redes</p>
        </div>
        <div class="partner-card">
          <div class="partner-logo">
            <span class="emoji-cutout emoji-lg theme-solar flutter">üé•</span>
          </div>
          <h3>Creadores de Contenido</h3>
          <p>Amplificaci√≥n del mensaje</p>
        </div>
      </div>
    </div>
  </section>

  <section class="impact-cta">
    <div class="container">
      <div class="cta-content">
        <h2>S√© Parte del Impacto</h2>
        <p>Tu apoyo puede multiplicar nuestro alcance</p>
        <div class="cta-actions">
          <a
            href={`${basePath}/es/recursos/#patrocinadores`}
            class="btn btn-primary"
          >
            <span class="emoji-cutout emoji-button emoji-md theme-green"
              >üíö</span
            > Apoyar el Proyecto
          </a>
          <a href={`${basePath}/es/comunidad/`} class="btn btn-secondary">
            <span class="emoji-cutout emoji-button emoji-md theme-community"
              >ü§ù</span
            > Unirse como Voluntario
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .hero-impacto {
    background: linear-gradient(
      135deg,
      var(--verde-sostenible) 0%,
      var(--amarillo-solar) 100%
    );
    padding: var(--espacio-xxl) 0;
    text-align: center;
    color: var(--text-primary);
  }

  /* Ensure readable text on gradient in both themes */
  :global([data-theme='light']) .hero-impacto {
    color: var(--madfam-black);
  }

  /* Dark mode - both direct selection and auto theme with dark preference */
  :global([data-theme='dark']) .hero-impacto,
  :global([data-theme-selection='auto'][data-theme='dark']) .hero-impacto {
    /* Use white text in dark mode for proper contrast */
    color: #ffffff !important;
    text-shadow: 0 1px 2px var(--cutout-shadow-dark);
  }

  /* Make sure all text elements inherit the color with high specificity */
  .hero-impacto h1,
  .hero-impacto p,
  .hero-impacto .hero-description {
    color: inherit !important;
  }

  /* Extra specificity for dark mode to override theme variables */
  :global([data-theme='dark']) .hero-impacto h1,
  :global([data-theme='dark']) .hero-impacto p,
  :global([data-theme='dark']) .hero-impacto .hero-description,
  :global([data-theme-selection='auto'][data-theme='dark']) .hero-impacto h1,
  :global([data-theme-selection='auto'][data-theme='dark']) .hero-impacto p,
  :global([data-theme-selection='auto'][data-theme='dark'])
    .hero-impacto
    .hero-description {
    color: #ffffff !important;
  }

  .hero-impacto h1 {
    font-size: 3rem;
    margin-bottom: var(--espacio-md);
  }

  .hero-description {
    font-size: 1.2rem;
    max-width: 600px;
    margin: 0 auto;
    opacity: 0.9;
  }

  /* Dashboard Section */
  .impact-dashboard {
    padding: var(--espacio-xxl) 0;
    background: var(--fondo-secundario);
  }

  .impact-dashboard h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: var(--espacio-xl);
  }

  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--espacio-xl);
  }

  .metric-icon {
    font-size: 3rem;
    display: block;
    margin-bottom: var(--espacio-md);
  }

  .metric-value {
    font-size: 3rem;
    font-weight: 900;
    color: var(--texto-primario);
    display: inline-block;
  }

  .metric-suffix {
    font-size: 2rem;
    font-weight: 900;
    color: var(--texto-primario);
  }

  .metric-label {
    display: block;
    color: var(--texto-secundario);
    margin-top: var(--espacio-sm);
    margin-bottom: var(--espacio-md);
  }

  .metric-progress {
    height: 8px;
    background: var(--fondo-secundario);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: var(--espacio-sm);
  }

  .progress-bar {
    height: 100%;
    background: linear-gradient(
      90deg,
      var(--verde-sostenible) 0%,
      var(--verde-brillante) 100%
    );
    transition: width 1s ease;
  }

  .metric-goal {
    font-size: 0.875rem;
    color: var(--texto-secundario);
  }

  /* Phases Impact */
  .impact-phases {
    padding: var(--espacio-xxl) 0;
  }

  .impact-phases h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: var(--espacio-xl);
  }

  .phases-impact-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: var(--espacio-xl);
  }

  .phase-impact-card {
    background: var(--bg-secondary, #1a1a1b);
    color: var(--text-primary, #ffffff);
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid var(--border-subtle, rgba(255, 255, 255, 0.1));
    box-shadow: 0 4px 6px var(--cutout-shadow-dark);
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }

  .phase-impact-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px var(--shadow-overlay-dark-medium);
  }

  .phase-impact-card[data-fase='1'] .phase-header {
    background: var(--fase-1-primary);
  }

  .phase-impact-card[data-fase='2'] .phase-header {
    background: var(--fase-2-primary);
  }

  .phase-impact-card[data-fase='3'] .phase-header {
    background: var(--fase-3-primary);
  }

  .phase-header {
    padding: var(--espacio-lg);
    color: var(--text-on-accent, var(--madfam-black));
    text-align: center;
  }

  .phase-icon {
    font-size: 2.5rem;
    display: block;
    margin-bottom: var(--espacio-sm);
  }

  .phase-header h3 {
    margin: 0;
    color: var(--text-on-accent, var(--madfam-black));
  }

  .phase-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--espacio-md);
    padding: var(--espacio-lg);
    border-bottom: 1px solid var(--borde-claro);
  }

  .stat-item {
    text-align: center;
  }

  .stat-item .stat-value {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--texto-primario);
  }

  .stat-item .stat-label {
    display: block;
    font-size: 0.75rem;
    color: var(--texto-secundario);
    margin-top: var(--espacio-xs);
  }

  .phase-achievements {
    padding: var(--espacio-lg);
  }

  .phase-achievements h3 {
    margin-bottom: var(--espacio-md);
    color: var(--texto-primario);
  }

  .phase-achievements ul {
    list-style: none;
    padding: 0;
  }

  .phase-achievements li {
    padding: var(--espacio-sm) 0;
    color: var(--texto-secundario);
  }

  /* Stories Section */
  .impact-stories {
    padding: var(--espacio-xxl) 0;
    background: var(--fondo-secundario);
  }

  .impact-stories h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: var(--espacio-xl);
  }

  .stories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--espacio-xl);
  }

  .story-card {
    background: var(--bg-secondary, #1a1a1b);
    color: var(--text-primary, #ffffff);
    padding: var(--espacio-xl);
    border-radius: 16px;
    border-left: 4px solid var(--verde-sostenible);
    border-right: 1px solid var(--border-subtle, rgba(255, 255, 255, 0.1));
    border-top: 1px solid var(--border-subtle, rgba(255, 255, 255, 0.1));
    border-bottom: 1px solid var(--border-subtle, rgba(255, 255, 255, 0.1));
    box-shadow: 0 4px 6px var(--cutout-shadow-dark);
    margin: 0;
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }

  .story-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 24px var(--shadow-overlay-dark-medium);
  }

  .story-card p {
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: var(--espacio-lg);
    font-style: italic;
  }

  .story-card footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .story-card cite {
    font-weight: 600;
    font-style: normal;
    color: var(--texto-primario);
  }

  .story-location {
    color: var(--texto-secundario);
    font-size: 0.9rem;
  }

  /* Visualization */
  .impact-visualization {
    padding: var(--espacio-xxl) 0;
  }

  .impact-visualization h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: var(--espacio-xl);
  }

  .growth-chart {
    max-width: 800px;
    margin: 0 auto;
  }

  .chart-placeholder {
    background: var(--fondo-secundario);
    padding: var(--espacio-xl);
    border-radius: 16px;
    height: 300px;
    position: relative;
  }

  .chart-bars {
    display: flex;
    align-items: flex-end;
    justify-content: space-around;
    height: 100%;
    gap: var(--espacio-md);
  }

  .bar {
    flex: 1;
    background: linear-gradient(
      to top,
      var(--verde-sostenible),
      var(--amarillo-solar)
    );
    border-radius: 8px 8px 0 0;
    position: relative;
    opacity: 0;
    animation: growBar 1s ease-out forwards;
  }

  .bar::after {
    content: attr(data-month);
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.875rem;
    color: var(--texto-secundario);
  }

  @keyframes growBar {
    to {
      opacity: 1;
    }
  }

  .bar:nth-child(1) {
    animation-delay: 0.1s;
  }
  .bar:nth-child(2) {
    animation-delay: 0.2s;
  }
  .bar:nth-child(3) {
    animation-delay: 0.3s;
  }
  .bar:nth-child(4) {
    animation-delay: 0.4s;
  }
  .bar:nth-child(5) {
    animation-delay: 0.5s;
  }
  .bar:nth-child(6) {
    animation-delay: 0.6s;
  }

  .chart-caption {
    text-align: center;
    color: var(--texto-secundario);
    margin-top: var(--espacio-xl);
  }

  /* Partners */
  .impact-partners {
    padding: var(--espacio-xxl) 0;
    background: var(--fondo-secundario);
  }

  .impact-partners h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: var(--espacio-md);
  }

  .partners-intro {
    text-align: center;
    font-size: 1.1rem;
    color: var(--texto-secundario);
    margin-bottom: var(--espacio-xl);
  }

  .partners-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--espacio-xl);
    max-width: 900px;
    margin: 0 auto;
  }

  .partner-card {
    text-align: center;
    background: var(--bg-secondary, #1a1a1b);
    color: var(--text-primary, #ffffff);
    padding: var(--espacio-xl);
    border-radius: 12px;
    border: 1px solid var(--border-subtle, rgba(255, 255, 255, 0.1));
    box-shadow: 0 4px 6px var(--cutout-shadow-dark);
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }

  .partner-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px var(--shadow-overlay-dark-medium);
  }

  .partner-logo {
    font-size: 3rem;
    margin-bottom: var(--espacio-md);
  }

  .partner-card h3 {
    margin-bottom: var(--espacio-sm);
    color: var(--verde-sostenible);
  }

  /* CTA */
  .impact-cta {
    padding: var(--espacio-xxl) 0;
    background: linear-gradient(
      135deg,
      var(--fondo-primario) 0%,
      rgba(76, 175, 80, 0.05) 100%
    );
  }

  .impact-cta .cta-content {
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
  }

  .impact-cta h2 {
    font-size: 2.5rem;
    margin-bottom: var(--espacio-md);
  }

  .impact-cta p {
    font-size: 1.2rem;
    color: var(--texto-secundario);
    margin-bottom: var(--espacio-xl);
  }

  .cta-actions {
    display: flex;
    gap: var(--espacio-md);
    justify-content: center;
  }

  @media (max-width: 768px) {
    .hero-impacto h1 {
      font-size: 2rem;
    }

    .metric-value {
      font-size: 2.5rem;
    }

    .phase-stats {
      grid-template-columns: 1fr;
    }

    .cta-actions {
      flex-direction: column;
      align-items: center;
    }
  }
</style>

<script>
  // Animate counters
  document.addEventListener('DOMContentLoaded', () => {
    const counters = document.querySelectorAll('.metric-value[data-count]');

    const animateCounter = (counter: HTMLElement) => {
      const target = parseInt(counter.dataset.count || '0');
      const duration = 2000;
      const increment = target / (duration / 16);
      let current = 0;

      const updateCounter = () => {
        current += increment;
        if (current < target) {
          counter.textContent = Math.floor(current).toLocaleString();
          requestAnimationFrame(updateCounter);
        } else {
          counter.textContent = target.toLocaleString();
        }
      };

      updateCounter();
    };

    // Intersection Observer for animation trigger
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          animateCounter(entry.target as HTMLElement);
          observer.unobserve(entry.target);
        }
      });
    });

    counters.forEach((counter) => observer.observe(counter));
  });
</script>
